generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   String           @id @default(cuid())
  email                String           @unique
  name                 String?
  password             String
  verified             Boolean          @default(false)
  verifyPin            String?
  resetPasswordExpires DateTime?
  resetPasswordToken   String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  accounts             Account[]
  budgets              Budget[]
  categories           Category[]
  monthlySummaries     MonthlySummary[]
  transactions         Transaction[]
}

model Account {
  id           String        @id @default(cuid())
  name         String
  type         AccountType
  balance      Decimal       @default(0.0) @db.Decimal(10, 2)
  userId       String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
}

model MonthlySummary {
  id           String        @id @default(cuid())
  month        Int
  year         Int
  userId       String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  budgets      Budget[]
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@unique([userId, month, year])
}

model Category {
  id           String          @id @default(cuid())
  name         String
  type         TransactionType
  userId       String
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  budgets      Budget[]
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@unique([userId, name, type])
}

model Transaction {
  id               String          @id @default(cuid())
  amount           Decimal         @db.Decimal(10, 2)
  type             TransactionType
  description      String
  date             DateTime
  userId           String
  categoryId       String
  accountId        String
  monthlySummaryId    String
  budgetId            String?
  relatedTransactionId String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  account             Account         @relation(fields: [accountId], references: [id])
  category            Category        @relation(fields: [categoryId], references: [id])
  monthlySummary      MonthlySummary  @relation(fields: [monthlySummaryId], references: [id], onDelete: Cascade)
  budget              Budget?         @relation(fields: [budgetId], references: [id])
  relatedTransaction  Transaction?    @relation("RelatedTransaction", fields: [relatedTransactionId], references: [id])
  otherRelated        Transaction[]   @relation("RelatedTransaction")
  user                User            @relation(fields: [userId], references: [id], onDelete: NoAction)
}

model Budget {
  id               String         @id @default(cuid())
  name             String
  description      String?
  amount           Decimal        @db.Decimal(10, 2)
  userId           String
  categoryId       String
  monthlySummaryId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  category         Category       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  monthlySummary   MonthlySummary @relation(fields: [monthlySummaryId], references: [id], onDelete: Cascade)
  user             User           @relation(fields: [userId], references: [id], onDelete: NoAction)
  transactions     Transaction[]
}

enum TransactionType {
  INGRESO
  EGRESO
  AHORRO
  INVERSION
}

enum AccountType {
  BANCO
  EFECTIVO
  TARJETA_CREDITO
  BILLETERA_DIGITAL
}
